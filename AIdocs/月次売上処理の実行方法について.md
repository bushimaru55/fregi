# 月次売上処理の実行方法について

作成日: 2026-01-13

## 質問

**決済の売り上げ処理はFレジ側の管理画面からやるんですよね？**

## 回答

F-REGIの月次売上処理には**2つの方法**があります：

### 方法1: F-REGI管理画面から手動実行

F-REGI管理画面の「月次課金サービス」→「売上一括処理」から手動で実行する方法です。

**特徴**:
- F-REGI管理画面から直接実行
- 手動操作が必要
- 複数の顧客を一括処理可能

### 方法2: API経由で自動実行（salem.cgi）

`salem.cgi` APIを使用して、プログラムから自動的に月次売上処理を実行する方法です。

**特徴**:
- プログラム（Laravelコマンド等）から自動実行
- Cronスケジュールで自動化可能
- 手動操作が不要

**実装計画（Phase 3）**:
- 月次売上処理コマンド（`ProcessMonthlySales`）の実装
- Cronスケジュール設定（毎月1日の深夜に実行）
- `salem.cgi` APIを使用してCUSTOMERIDを指定して売上処理を実行

## F-REGI仕様書の内容

### salem.cgi API（月次売上処理）

**エンドポイント:**
- 本番: `https://ssl.f-regi.com/connect/salem.cgi`
- テスト: `https://ssl.f-regi.com/connecttest/salem.cgi`

**パラメータ:**
- `SHOPID`（必須）: 店舗ID
- `CUSTOMERID`（必須）: 顧客番号
- `PAY`（必須）: 金額
- `SALEDATE`（任意）: 売上日（YYYY/MM/DD または YYYYMMDD）

**特徴:**
- **CUSTOMERIDのみを指定**すればよい
- カード情報の再入力は不要（F-REGI側で管理されている）

## 実装方針の選択

### 現在の実装計画（Phase 3）

**自動実行（API経由）を想定:**
- Laravelコマンド（`ProcessMonthlySales`）を作成
- Cronスケジュールで毎月1日に自動実行
- `salem.cgi` APIを使用してCUSTOMERIDを指定して売上処理を実行

**メリット:**
- 自動化できるため、手動操作が不要
- 運用コストが低い

### 手動実行（F-REGI管理画面）の場合

もしF-REGI管理画面から手動で実行する方針の場合：

**実装内容:**
- Phase 3の自動実行コマンドは実装しない
- F-REGI管理画面から手動で実行する運用を想定
- ただし、`salem.cgi` APIサービスは実装済み（必要に応じて使用可能）

## 確認事項

**どちらの方法で月次売上処理を行いますか？**

1. **F-REGI管理画面から手動実行**
   - Phase 3の自動実行コマンドは実装しない
   - F-REGI管理画面から手動で実行する運用

2. **API経由で自動実行（現在の実装計画）**
   - Phase 3で自動実行コマンドを実装
   - Cronスケジュールで毎月1日に自動実行

**両方の方法をサポートすることも可能です:**
- 自動実行コマンドを実装（通常運用）
- F-REGI管理画面から手動実行も可能（必要に応じて）

## まとめ

- F-REGI管理画面から手動実行する方法もあります
- API経由で自動実行する方法もあります
- どちらの方法で運用するかによって、実装内容が変わります

現在の実装計画（Phase 3）では、自動実行（API経由）を想定していますが、手動実行に変更することも可能です。
