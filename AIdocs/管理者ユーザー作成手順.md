# 管理者ユーザー作成手順

作成日: 2026-01-22

## 概要

管理画面にログインするための管理者ユーザー（`kanri@dschatbot.ai`）を作成します。

**認証情報**:
- メールアドレス: `kanri@dschatbot.ai`
- パスワード: `cs20051101`

---

## 前提条件

- `users` テーブルが存在すること（Laravelのデフォルトマイグレーションで作成済み）
- phpMyAdminまたはPleskのデータベース管理ツールにアクセスできること

---

## 手順

### ステップ1: phpMyAdminにアクセス

PleskのコントロールパネルからphpMyAdminにアクセスします。

### ステップ2: データベースを選択

該当するデータベースを選択します。

### ステップ3: SQLタブを開く

phpMyAdminの上部メニューから「SQL」タブをクリックします。

### ステップ4: SQLを実行

以下のSQLをコピー＆ペーストして実行します：

```sql
-- kanri@dschatbot.ai ユーザーの作成/更新
INSERT INTO `users` (`name`, `email`, `password`, `email_verified_at`, `created_at`, `updated_at`)
VALUES (
    'kanri',
    'kanri@dschatbot.ai',
    '$2y$10$1Q08LmDkpaZpHfQa58Qf.OuG8WR3lePMoSVsSv0isTk/pl3b.k6CK',
    NOW(),
    NOW(),
    NOW()
)
ON DUPLICATE KEY UPDATE
    `name` = VALUES(`name`),
    `password` = VALUES(`password`),
    `email_verified_at` = VALUES(`email_verified_at`),
    `updated_at` = NOW();
```

**注意**: 
- このSQLは既存のユーザーが存在する場合は更新（UPDATE）します
- 既存のユーザーが存在しない場合は新規作成（INSERT）します
- `email` カラムに `UNIQUE` 制約があるため、重複エラーは発生しません

### ステップ5: 実行結果の確認

実行後、以下のSQLでユーザーが正しく作成されたか確認します：

```sql
SELECT id, name, email, email_verified_at, created_at 
FROM users 
WHERE email = 'kanri@dschatbot.ai';
```

**期待される結果**:
- `id`: 数値（自動採番）
- `name`: `kanri`
- `email`: `kanri@dschatbot.ai`
- `email_verified_at`: 現在の日時
- `created_at`: 現在の日時

---

## ログイン確認

### ステップ1: ログインページにアクセス

ブラウザで以下のURLにアクセスします：

```
https://dschatbot.ai/webroot/billing/login
```

### ステップ2: ログイン情報を入力

- **メールアドレス**: `kanri@dschatbot.ai`
- **パスワード**: `cs20051101`

### ステップ3: ログイン

「ログイン」ボタンをクリックします。

### ステップ4: ダッシュボードにリダイレクト

ログイン成功後、以下のURLにリダイレクトされます：

```
https://dschatbot.ai/webroot/billing/admin/dashboard
```

---

## トラブルシューティング

### ログインできない場合

1. **パスワードが間違っている**
   - パスワードは `cs20051101` です（大文字小文字を区別します）

2. **ユーザーが存在しない**
   - SQLの実行結果を確認してください
   - `SELECT * FROM users WHERE email = 'kanri@dschatbot.ai';` でユーザーの存在を確認

3. **パスワードハッシュが正しくない**
   - 上記のSQLを再実行してください
   - パスワードハッシュは `$2y$10$1Q08LmDkpaZpHfQa58Qf.OuG8WR3lePMoSVsSv0isTk/pl3b.k6CK` です

4. **セッションエラー**
   - ブラウザのキャッシュとCookieをクリアして再試行してください

### SQL実行エラー

1. **テーブルが存在しない**
   - `users` テーブルが存在するか確認してください
   - 存在しない場合は、Laravelのマイグレーションを実行してください

2. **カラムが存在しない**
   - `users` テーブルの構造を確認してください
   - 必要なカラム: `id`, `name`, `email`, `password`, `email_verified_at`, `created_at`, `updated_at`

3. **UNIQUE制約エラー**
   - `ON DUPLICATE KEY UPDATE` を使用しているため、通常はエラーになりません
   - エラーが発生する場合は、既存のユーザーを削除してから再実行してください

---

## 参考

- 関連ファイル: `AIdocs/管理者ユーザー作成SQL.sql`
- ログインビュー: `app/resources/views/auth/login.blade.php`
- 認証コントローラー: `app/app/Http/Controllers/Auth/AuthenticatedSessionController.php`

---

作成日: 2026-01-22
