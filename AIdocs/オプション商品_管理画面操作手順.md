# オプション商品：管理画面操作手順

作成日: 2026-01-21

## 概要

管理画面からオプション商品を登録・編集・削除する手順を説明します。

---

## アクセス方法

### ローカル環境
- **管理画面ログイン**: `http://localhost:8080/billing/login`
- **商品管理**: `http://localhost:8080/billing/admin/products`

### 本番環境
- **管理画面ログイン**: `https://dschatbot.ai/webroot/billing/login`
- **商品管理**: `https://dschatbot.ai/webroot/billing/admin/products`

### ログイン情報
- **メールアドレス**: `kanri@dschatbot.ai`
- **パスワード**: `cs20051101`

---

## オプション商品の新規登録手順

### 1. 管理画面にログイン

1. ログイン画面にアクセス
2. メールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック

### 2. 商品管理画面に移動

1. 管理画面のメニューから「商品管理」をクリック
   - または直接 `/billing/admin/products` にアクセス

### 3. 新規商品を作成

1. 商品一覧画面の右上にある「新規作成」ボタンをクリック
2. 商品登録フォームに以下の情報を入力：

   **必須項目:**
   - **商品名**: 例）「プライオリティサポート」
   - **商品コード**: 例）「OPT-SUPPORT」（重複不可）
   - **単価（税込）**: 例）`5000`（円単位、税込）
   - **商品種別**: 「オプション」を選択
   - **表示順**: 例）`1`（数値が小さいほど上に表示）

   **任意項目:**
   - **商品説明**: 商品の詳細説明（任意）
   - **この商品を有効にする**: チェックを入れる（デフォルトでON）

3. 「作成」ボタンをクリック

### 4. 登録完了確認

- 商品一覧画面に戻り、登録した商品が表示されることを確認
- 商品種別が「オプション」（緑色のバッジ）になっていることを確認
- 「有効」ステータスになっていることを確認

---

## オプション商品の編集手順

### 1. 商品一覧から編集対象を選択

1. 商品管理画面（`/billing/admin/products`）にアクセス
2. 編集したい商品の行にある「編集」ボタンをクリック

### 2. 商品情報を編集

1. 商品編集フォームで必要な項目を修正
   - 商品名、商品コード、単価、商品説明、表示順、有効フラグなど
2. 「更新」ボタンをクリック

### 3. 更新完了確認

- 商品一覧画面に戻り、変更が反映されていることを確認

---

## オプション商品の削除手順

### 注意事項

⚠️ **重要**: 既に契約で使用されている商品は削除できません。

削除を試みた場合、エラーメッセージが表示され、削除は実行されません。

### 削除手順

1. 商品一覧画面で削除したい商品の行にある「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック
3. 削除が完了すると、商品一覧から該当商品が消えます

---

## 商品種別の説明

### プラン（plan）
- 契約プランとして使用される商品
- 通常は契約プラン管理（`contract_plans`）で管理されますが、商品マスタにも登録可能

### オプション（option）⭐ **オプション商品はこちら**
- ベース商品（契約プラン）に追加できるオプション商品
- 申込フォームでチェックボックスで選択可能
- **買い切り（一回限り）**として扱われます

### 追加商品（addon）
- 将来的な拡張用
- 現在はオプションと同じ扱い

---

## オプション商品の設定例

### 例1: プライオリティサポート

- **商品名**: プライオリティサポート
- **商品コード**: `OPT-SUPPORT`
- **単価（税込）**: `5000`
- **商品種別**: オプション
- **商品説明**: 24時間以内の優先サポート対応
- **表示順**: `1`
- **有効フラグ**: ON

### 例2: データバックアップ

- **商品名**: データバックアップ
- **商品コード**: `OPT-BACKUP`
- **単価（税込）**: `3000`
- **商品種別**: オプション
- **商品説明**: 月次自動バックアップサービス
- **表示順**: `2`
- **有効フラグ**: ON

### 例3: 追加ストレージ

- **商品名**: 追加ストレージ 100GB
- **商品コード**: `OPT-STORAGE-100`
- **単価（税込）**: `2000`
- **商品種別**: オプション
- **商品説明**: 追加ストレージ容量 100GB
- **表示順**: `3`
- **有効フラグ**: ON

---

## 申込フォームでの表示確認

### 確認手順

1. 公開ページの申込フォームにアクセス
   - ローカル: `http://localhost:8080/billing/contract/create`
   - 本番: `https://dschatbot.ai/webroot/billing/contract/create`

2. オプション商品セクションを確認
   - 「オプション商品」という見出しが表示される
   - 登録したオプション商品がチェックボックスで表示される
   - 商品名、単価、説明が表示される

3. オプション商品を選択して申込フローを確認
   - チェックボックスを選択
   - 「確認画面へ」をクリック
   - 確認画面で選択したオプション商品と合計金額が表示されることを確認

---

## よくある質問（FAQ）

### Q1: 商品コードは何を入力すればいいですか？

**A**: 商品を識別するための一意のコードです。例：
- `OPT-SUPPORT`（オプション-サポート）
- `OPT-BACKUP`（オプション-バックアップ）
- `PLAN-050`（プラン-50ページ）

重複は不可です。

### Q2: 表示順はどのように設定すればいいですか？

**A**: 数値が小さいほど上に表示されます。
- `1` → 最上部
- `2` → 2番目
- `10` → 10番目

同じ数値の場合は、IDの昇順で表示されます。

### Q3: オプション商品を無効にするとどうなりますか？

**A**: 申込フォームに表示されなくなります。既存の契約には影響しません。

### Q4: 商品を削除できないのはなぜですか？

**A**: 既に契約で使用されている商品は削除できません。削除したい場合は、まず該当する契約を確認してください。

### Q5: オプション商品の価格を変更した場合、既存の契約に影響はありますか？

**A**: ありません。契約明細（`contract_items`）には契約時点の価格がスナップショットとして保存されるため、商品マスタの価格変更は既存契約に影響しません。

---

## トラブルシューティング

### エラー: 「商品コードが既に使用されています」

**原因**: 同じ商品コードが既に登録されています。

**対処**: 別の商品コードを使用してください。

### エラー: 「この商品は既に契約で使用されているため削除できません」

**原因**: この商品が既に契約明細（`contract_items`）で使用されています。

**対処**: 
1. 該当する契約を確認
2. 削除が必要な場合は、まず契約を削除または変更してから商品を削除

### オプション商品が申込フォームに表示されない

**確認項目:**
1. 商品種別が「オプション」になっているか
2. 有効フラグがONになっているか
3. ブラウザのキャッシュをクリアして再読み込み

---

## 参考資料

- **実装仕様書**: `オプション商品機能_実装仕様.md`
- **データベース構造**: `オプション商品機能_本番環境マイグレーションSQL.sql`
- **商品管理機能**: `AIdocs_商品管理と認証機能.md`

---

作成日: 2026-01-21
