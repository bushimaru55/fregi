# F-REGI月額課金仕様書 目次

参考資料: F-REGI クレジットカード処理インターフェース仕様書（月次課金仕様 authm.cgi）Ver2.8 2025/07/23版

作成日: 2026-01-13

## 関連ドキュメント

1. **[F-REGI月額課金仕様書（authm.cgi）.md](./F-REGI月額課金仕様書（authm.cgi）.md)**
   - 月額課金の実装に必要な全API仕様をまとめた詳細ドキュメント
   - オーソリ処理、売上処理、顧客管理、通知処理など

2. **[月額プランの自動引き落としについて.md](./月額プランの自動引き落としについて.md)**
   - 現在の実装状況と自動引き落としの実装方法について

3. **[F-REGI仕様書確認結果.md](./F-REGI仕様書確認結果.md)**
   - リダイレクト決済とオーソリ処理の違いについて

## 重要なポイント

### 現在の実装との違い

| 項目 | リダイレクト決済（現在） | オーソリ処理（月額課金用） |
|------|----------------------|------------------------|
| **APIエンドポイント** | `compsettleapply.cgi` | `authm.cgi` |
| **決済タイプ** | 一回限り | 一回限りまたは月額課金 |
| **カード情報入力** | F-REGI画面 | 自社サイト（直接API） |
| **月額課金対応** | ❌ 不可 | ✅ 可能（`MONTHLY=1`） |
| **自動引き落とし** | ❌ 不可 | ✅ 可能（`salem.cgi`） |
| **CUSTOMERID** | 使用しない | 使用する（月次売上用） |

### 月額課金の実装フロー

1. **初回決済（顧客登録）**
   - `authm.cgi`を使用
   - `MONTHLY=1`, `MONTHLYMODE=0`を指定
   - `CUSTOMERID`を生成・指定
   - カード情報を直接送信

2. **月次売上処理（自動引き落とし）**
   - `salem.cgi`を使用
   - `CUSTOMERID`を指定
   - カード情報の再入力は不要

3. **一括売上処理（オプション）**
   - `csvsalem.cgi`を使用
   - CSV形式で複数の月次売上を一括処理

### 必要な実装作業

詳細は `月額プランの自動引き落としについて.md` を参照してください。

主要な作業:
1. オーソリ処理（authm.cgi）への切り替え
2. 月次売上処理（salem.cgi）の実装
3. カード情報の直接入力フォームの実装
4. 通知処理の実装
5. セキュリティ対応（PCI DSS準拠など）

---

作成日: 2026-01-13
